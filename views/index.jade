extends layout

mixin app(app)
  .span6.app(data-connected=app.connected, data-namespace=app.namespace)
    div
      a.cover(href='/#{app.namespace}/login')
        img(src='#{app.image}')
      div.controls
        if !app.connected
          a.btn.btn-primary.btn-small(href='/#{app.namespace}/login') Connect
        else
          a.btn.btn-danger.btn-small(href='/#{app.namespace}/logout') Log out
      .description
        h3 #{app.name}
        p
          | #{app.description}

block head
  title= title
  script(src='/socket.io/socket.io.js')
  script(src='/js/index.js')
  link(rel='stylesheet', href='/css/style.css')

block content
  div.header
    p 
      b Lifegraph Connect
      |  Securely link your physical identity with your Facebook identity.
      if (lifegraphConnected)
        a.right.btn.btn-danger(href='/admin') See your apps
      else
        a.right(href="/#{lifegraphNamespace}/login") Login to admin your apps

  div.container-fluid
    if device
      p#token-status Connected tokens:
        span.label.label-success(data-pid=device.pid)
          | ##{device.pid}
    else
      p#token-status
        | No physical tokens connected.

    .alert.alert-info#unclaimed-token
      button.close(type="button", data-dismiss="alert") &times;
      | An unclaimed ID just connected to 
      span.namespace
      | .
      button.btn.btn-info.btn-small(style="margin-left: 15px")
        | Claim this ID
      |  
      button.btn.btn-small(type="button", data-dismiss="alert")
        | Dismiss

    #apps
      each app, i in apps
        // using the app mixin
        if i % 2 == 0
          .row-fluid
            +app(app) 
            if (i + 1 < apps.length)
              +app(apps[i+1])
            